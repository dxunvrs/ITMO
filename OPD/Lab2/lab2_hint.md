# Команды и этапы их выполнения для 2 лабы

## Команды
Есть 4 вида команд: безадресные, ввода-вывода, адресные и ветвления.  
У каждой команды есть несколько циклов выполнения:
1. Цикл выборки команды (Instruction Fetch, IF)
2. Цикл выборки адреса (Address Fetch, AF)
3. Цикл выборки операнда (Operand Fetch, OF)
4. Цикл исполнения (Execution, EX)
5. Цикл прерывания (Interruption, INT)

Здесь рассмотрим только безадресные и адресные команды, нужные для этой лабы(т.е. без команд с SP)

Также команды по итогам выполнения расставляют 4 флага: N,Z,V,C  
*: установка по результату, 0: всегда ставит в ноль, -: не трогает

## Про адресацию:  
Если первые(с начала) четыре бита 0, то команда безадресная  
0001... - команда ввода-выводв(не нужно для этой лабы)
1111... - команда ветвления(не нужно для этой лабы)  

В данной лабе рассматриваются команды с абсолютной адресацией(одиннадцатый бит 0)  
Кстати в связи с этим, для номера ячейки остается ровно 11 бит, то есть 2^11=2048 вариантов

## Циклы выполнения в этой лабе
Для безадресных команд нет AF и OF(важно знать для защиты)  
Также у всех команд одинаковый IF, распишем его:
- IF:
    1. IP -> BR, AR
    2. BR + 1 -> IP; MEM(AR) -> DR
    3. DR -> CR

Ну и еще у всех адресных команд с абсолютной адресацией нет AF, а OF одинаковый, распишем его, чтобы не дублировать сто раз одно и то же:
- AF: отсутствует для абсолютной адресации
- OF:
    1. DR -> AR; MEM(AR) -> DR

Осталось расписать цикл исполнения для команд

## Безадресные команды
Обращение к памяти всегда 1 и происходит в момент цикла выборки команды  
### HLT - 0100
HLT - остановка БЭВМ  
Установка флагов NZVC: ----
- EX:
    1. STOP

### CLA - 0200
CLA - очистка аккумулятора  
Установка флагов NZVC: **0-
- EX:
    1. 0 -> AC,N,Z,V

### NOT - 0280
NOT - инверсия аккумулятора  
Установка флагов NZVC: **0-
- EX:
    1. ~AC -> AC,N,Z,V

### CLC - 0300
CLC - очистка carry флага  
Установка флагов NZVC: ---0
- EX:
    1. 0 -> C

### CMC - 0380
CMC - инверсия регистра переноса  
Установка флагов NZVC: ---*
- EX:
    1. ~C -> C

### ROL - 0400
ROL - циклический сдвиг влево, AC и C сдвигаются по циклу так, что AC_15 -> C, C -> AC_0  
Установка флагов NZVC: ****
- EX:
    1. ROL(AC) -> AC,N,Z,V,C

### ROR - 0480
ROR - циклический сдвиг вправо, AC и C сдвигаются по циклу так, что AC_0 -> C, C -> AC_15  
Установка флагов NZVC: ****
- EX:
    1. ROR(AC) -> AC,N,Z,V,C

### ASL - 0500
ASL - арифметический сдвиг влево, AC и C сдвигаются влево так, что AC_15 -> C, 0 -> AC_0  
Установка флагов NZVC: ****
- EX:
    1. AC -> DR
    2. AC + DR -> AC,N,Z,V,C

### ASR - 0580
ASR - арифметический сдвиг вправо, AC и C сдвигаются вправо так, что AC_0 -> C, AC_15 -> AC_14 (по факту, знак сохраняется)  
Установка флагов NZVC: ****
- EX:
    1. ASR(AC) -> AC,N,Z,V,C

### SXTB - 0600
SXTB - расширение знака младшего байта  
Установка флагов NZVC: **0-
- EX:
    1. extend sign AC(0..7) -> AC,N,Z,V

### SWAB - 0680
SWAB - обмен старшего и младшего байта  
Установка флагов NZVC: **0-
- EX:
    1. SWAB(AC) -> AC,N,Z,V

### INC - 0700
INC - инкремент  
Установка флагов NZVC: ****
- EX:
    1. AC + 1 -> AC,N,Z,V,C

### DEC - 0740
DEC - декремент  
Установка флагов NZVC: ****
- EX:
    1. AC + ~0 -> AC,N,Z,V,C

### NEG - 0780
NEG - изменение знака(получение доп.кода)  
Установка флагов NZVC: ****
- EX:
    1. ~AC + 1 -> AC,N,Z,V,C

## Команды с абсолютной адресацией
Обращений к памяти(не будем считать IF, OF и AF) в основном не бывает, но есть исключения)

### AND - 2XXX
AND - логическое и/умножение  
Установка флагов NZVC: **0-
- EX:
    1. AC & DR -> AC,N,Z,V

### OR - 3XXX
OR - логическое или/сложение. Из интересного: БЭВМ использует закон де Моргана  
Установка флагов NZVC: **0-
- EX:
    1. ~AC & ~DR -> BR
    2. ~BR -> AC,N,Z,V

### ADD - 4XXX
ADD - сложение  
Установка флагов NZVC: ****
- EX:
    1. AC + DR -> AC,N,Z,V,C

### ADC - 5XXX
ADC - сложение с переносом(еще и с carry флагом)  
Установка флагов NZVC: ****
- EX:
    1. если PS(C)=0, то бэвм использует обычный ADD
    2. иначе AC + DR + 1 -> AC,N,Z,V,C

### SUB - 6XXX
SUB - вычитание  
Установка флагов NZVC: ****
- EX:
    1. AC + ~DR + 1 -> AC,N,Z,V,C

### CMP - 7XXX
CMP - сравнение, БЭВМ устанавливает флаги по результату AC-M, при этом сохраняя аккумулятор  
Установка флагов NZVC: ****
- EX:
    1. AC + ~DR + 1 -> N,Z,V,C

### LOOP - 8XXX
LOOP - декремент и пропуск, передается ячейка счетчика, БЭВМ уменьшает его, если счетчик > 0, то выполняет следующую команду, иначе пропускает команду. Используется в связке с JUMP(примеры будут в следующей лабе, пока зачилльтесь)  
Установка флагов NZVC: ----
- EX:
    1. ~0 + DR -> DR
    2. ~0 + DR -> BR; DR -> MEM(AR)
    3. если BR(15)=0, то прерывание
    4. иначе IP + 1 -> IP

**Небольшое пояснение**  
Зачем БЭВМ два раза вычитает единицу? Во время выполнения БЭВМ не может посмотреть на флаги результата, потому что их нет). Поэтому БЭВМ уменьшает счетчик еще на один, получит отрицательное число(BR(15)=1)? Тогда перепрыгнет следующую команду. А если 0 или больше нуля, то остановит LOOP и пойдет выполнять следующую команду. (так достигается условие >0 на счетчик)

### Резерв - 9XXX. Зачем? Узнаете своевременно

### LD - AXXX
LD - загрузка  
Установка флагов NZVC: **0-
- EX:
    1. DR -> AC,N,Z,V

### SWAM - BXXX
SWAB - обмен аккумулятора и операнда(причем с загрузкой в память)  
Установка флагов NZVC: **0-
- EX:
    1. DR -> BR
    2. AC -> DR
    3. BR -> AC,N,Z,V; DR -> MEM(AR)

### JUMP - CXXX
JUMP - переход  
Установка флагов NZVC: ----
- EX:
    1. DR -> IP

### CALL - DXXX. Работа со стеком, пока не надо
  
### ST - EXXX
ST - сохранение  
Установка флагов NZVC: ----
- EX:
    1. DR -> AR
    2. AC -> DR
    3. DR -> MEM(AR)